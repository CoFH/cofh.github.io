{%- unless ver -%}
  {%- assign ver = page.version | replace: ".", "" -%}
{%- endunless -%}

{%- assign cache-ids = '' | split: '' -%}
{%- assign cache-links = '' | split: '' -%}

{%- assign subjects = nil -%}
{%- if include.subjects -%}
  {%- if include.subjects.first -%}
    {%- assign subjects = include.subjects -%}
  {%- else -%}
    {%- assign subjects = include.subjects | split: " " -%}
  {%- endif -%}
{%- endif -%}

{%- assign recipe-types = nil -%}
{%- if include.recipe-types -%}
  {%- if include.recipe-types.first -%}
    {%- assign recipe-types = include.recipe-types -%}
  {%- else -%}
    {%- assign recipe-types = include.recipe-types | split: " " -%}
  {%- endif -%}
{%- endif -%}

{%- assign recipe-ids = nil -%}
{%- if include.recipe-ids -%}
  {%- if include.recipe-ids.first -%}
    {%- assign recipe-ids = include.recipe-ids -%}
  {%- else -%}
    {%- assign recipe-ids = include.recipe-ids | split: " " -%}
  {%- endif -%}
{%- endif -%}

{%- if subjects -%}
  {%- assign recipes = '' | split: '' -%}
	{%- for subject in subjects -%}
    {%- assign cache-ids = cache-ids | push: subject -%}
    {%- capture cache-link -%}{% include docs/get-link.html id=subject %}{%- endcapture -%}
    {%- assign cache-links = cache-links | push: cache-link -%}
    
    {%- if include.show == nil or include.show == "makes" -%}
      {%- for recipe-group in site.data.docs[ver].items-fluids[subject].outputs -%}
        {%- assign recipe-type = recipe-group[0] -%}
        {%- if recipe-types == nil or recipe-types contains recipe-type -%}
          {%- for recipe-id in site.data.docs[ver].items-fluids[subject].outputs[recipe-type] -%}
            {%- if recipe-ids == nil or recipe-ids contains recipe-id -%}
              {%- assign namespaced-id = recipe-type | append: ":" | append: recipe-id -%}
              {%- assign recipes = recipes | push: namespaced-id -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
    
    {%- if include.show == nil or include.show == "uses" -%}
      {%- for recipe-group in site.data.docs[ver].items-fluids[subject].inputs -%}
        {%- assign recipe-type = recipe-group[0] -%}
        {%- if recipe-types == nil or recipe-types contains recipe-type -%}
          {%- for recipe-id in site.data.docs[ver].items-fluids[subject].inputs[recipe-type] -%}
            {%- if recipe-ids == nil or recipe-ids contains recipe-id -%}
              {%- assign namespaced-id = recipe-type | append: ":" | append: recipe-id -%}
              {%- assign recipes = recipes | push: namespaced-id -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
	{%- endfor -%}
  
  {%- assign recipes = recipes | uniq | group_by_exp: "id", "id | split: ':' | first" | sort: "name" -%}
{%- elsif recipe-types -%}
  {%- assign cache-ids = cache-ids | push: "" -%}
  {%- assign cache-links = cache-links | push: "" -%}
  
  {%- if recipe-ids -%}
    {%- assign recipes = '' | split: '' -%}
    {%- for recipe-type in recipe-types -%}
      {%- for recipe-id in recipe-ids -%}
        {%- if site.data.docs[ver].recipes[recipe-type][recipe-id] -%}
          {%- assign namespaced-id = recipe-type | append: ":" | append: recipe-id -%}
          {%- assign recipes = recipes | push: namespaced-id -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endfor -%}
    {%- assign recipes = recipes | group_by_exp: "id", "id | split: ':' | first" | sort: "name" -%}
  {%- else -%}
    {%- assign recipes = recipe-types | sort -%}
  {%- endif -%}
{%- elsif recipe-ids -%}
  {%- assign cache-ids = cache-ids | push: "" -%}
  {%- assign cache-links = cache-links | push: "" -%}
  
  {%- assign recipes = '' | split: '' -%}
  {%- for recipe-type in site.data.docs[ver].recipes -%}
    {%- for recipe-id in recipe-ids -%}
      {%- if recipe-type[1][recipe-id] -%}
        {%- assign namespaced-id = recipe-type[0] | append: ":" | append: recipe-id -%}
        {%- assign recipes = recipes | push: namespaced-id -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endfor -%}
  {%- assign recipes = recipes | group_by_exp: "id", "id | split: ':' | first" | sort: "name" -%}
{%- else -%}
  {%- assign recipes = '' | split: '' -%}
  {%- for recipe-type in site.data.docs[ver].recipes -%}
    {%- assign recipes = recipes | push: recipe-type[0] -%}
  {%- endfor -%}
  {%- assign recipes = recipes | sort -%}
{%- endif -%}

<div class="docs-recipe-tables {% if include.hidden %}tables-collapsed{% endif %}">
  Recipes&nbsp;[<span class="tables-toggle-hidden link" tabindex=0>{% if include.hidden %}Show{% else %}Hide{% endif %}</span>]
  {%- for recipe-type in recipes -%}
    {%- if recipe-type.items -%}
      {% include docs/recipe/table/table.html recipe-type=recipe-type.name recipe-ids=recipe-type.items %}
    {%- else -%}
      {% include docs/recipe/table/table.html recipe-type=recipe-type %}
    {%- endif -%}    
  {%- endfor -%}
</div>