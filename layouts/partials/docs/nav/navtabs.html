{{- $mods_versions := partialCached "docs/cache/mods_versions" .Page -}}
{{- $sorted_versions := slice -}}
{{- range $version, $mods := $mods_versions -}}
  {{- if $version -}}
    {{- $sorted_versions = $sorted_versions | append (int (slicestr $version 2)) -}}
  {{- end -}}
{{- end -}}
{{- $sorted_versions = apply (sort $sorted_versions) "printf" "1.%v" "." -}}

<nav class="docs-navtabs" role="navigation" aria-label="Documentation Navigation">
  <ul class="horz nav-list">
    {{- range $version := $sorted_versions -}}
      <li class="version-menu">
        <a href="javascript:void(0);" class="popup version-link nav-link{{ if eq (string $.Page.Params.version) $version }} nav-link-selected{{ end }}" has-popup="true" aria-expanded="false">{{$version}}</a>
        <ul class="vert nav-list hidden-list mod-list" aria-label="{{$version}} Mods Navigation">
          {{- $sorted_mods := slice -}}
          {{- range $mod, $pages := index $mods_versions $version -}}
            {{- if $mod -}}
              {{- $sorted_mods = $sorted_mods | append $mod -}}
            {{- end -}}
          {{- end -}}
          
          {{- range $mod := (sort $sorted_mods) -}}
            {{- $mod_main := partial "util/map_get" (dict "data" (index (partialCached "docs/cache/categorized_docs" (dict "Page" $.Page "mod" $mod "version" $version) $version $mod) "main") "keys" (slice "" "")) -}}
            <li>
              {{- $same_mod := false -}}
              {{- if reflect.IsSlice $.Page.Params.mods -}}
                {{- $same_mod = in (apply $.Page.Params.mods "title" ".") $mod -}}
              {{- else -}}
                {{- $same_mod = eq (title $.Page.Params.mods) $mod -}}
              {{- end -}}
              
              <a {{with $mod_main}}href="{{.RelPermalink}}" {{end}}class="mod-link nav-link{{ if and $same_mod (eq (string $.Page.Params.version) $version) }} nav-link-selected{{ end }}">
                <img class="mod-logo" src="/assets/images/logos/{{$version}}/{{ anchorize $mod }}.png" alt="{{$version}} {{$mod}}">
              </a>
            </li>
          {{- end -}}
        </ul>
      </li>
    {{- end -}}
  </ul>
</nav>