{{- $mods_versions := partialCached "docs/cache/mods_versions" .Page -}}
{{- $sorted_versions := slice -}}
{{- range $version, $mods := $mods_versions -}}
  {{- if $version -}}
    {{- $sorted_versions = $sorted_versions | append (int (slicestr $version 2)) -}}
  {{- end -}}
{{- end -}}
{{- $sorted_versions = apply (sort $sorted_versions) "printf" "1.%v" "." -}}

<nav class="docs-nav-dropdown" role="navigation" aria-label="Documentation Navigation">
  <button class="dropdown">
    <span>{{- default "Select Version" $.Page.Params.version -}}</span>
    <ol>
      {{- range $version := $sorted_versions -}}
        <li>
          {{- $version_main := (partial "util/map_get" (dict "data" (partialCached "docs/cache/categorized_docs" (dict "Page" $.Page "version" $version) $version) "keys" (slice "main" "" ""))) -}}
          <a {{with $version_main}}href="{{.RelPermalink}}" {{end}} class="nav-link{{ if eq (string $.Page.Params.version) $version }} nav-link-selected{{ end }}" has-popup="true" aria-expanded="false">
            {{$version}}
          </a>
        </li>
      {{- end -}}
    </ol>
  </button>
  {{- $version := $.Page.Params.version -}}
  {{- if $version -}}
    <button class="dropdown">
      <span>
        {{- $label := default "Select Mod" $.Page.Params.mods -}}
        {{- if reflect.IsSlice $label -}}
          {{- $label = delimit $label ", " -}}
        {{- end -}}
        {{- title $label -}}
      </span>
      <ol>
        {{- $sorted_mods := slice -}}
        {{- range $mod, $pages := index $mods_versions $version -}}
          {{- if $mod -}}
            {{- $sorted_mods = $sorted_mods | append $mod -}}
          {{- end -}}
        {{- end -}}
        
        {{- range $mod := (sort $sorted_mods) -}}
          {{- $mod_main := partial "util/map_get" (dict "data" (index (partialCached "docs/cache/categorized_docs" (dict "Page" $.Page "mod" $mod "version" $version) $version $mod) "main") "keys" (slice "" "")) -}}
          <li>
            {{- $same_mod := false -}}
            {{- if reflect.IsSlice $.Page.Params.mods -}}
              {{- $same_mod = in (apply $.Page.Params.mods "title" ".") $mod -}}
            {{- else -}}
              {{- $same_mod = eq (title $.Page.Params.mods) $mod -}}
            {{- end -}}
            
            <a {{with $mod_main}}href="{{.RelPermalink}}" {{end}}class="nav-link{{ if and $same_mod (eq (string $.Page.Params.version) $version) }} nav-link-selected{{ end }}">
              {{$mod}}
            </a>
          </li>
        {{- end -}}
      </ol>
    </button>
  {{- end -}}
</nav>