{{- $subject_map := dict -}}
{{- range where .Site.Pages "Section" "docs" -}}
  {{- $doc := . -}}
  {{- $version := string (default "none" $doc.Params.version) -}}
  
  {{- if reflect.IsSlice $doc.Params.subjects -}}
    {{- range $doc.Params.subjects -}}
      {{- $subject_map = partial "util/map_set" (dict "data" $subject_map "keys" (slice $version (anchorize .)) "value" $doc) -}}
    {{- end -}}
  {{- else -}}
    {{- $subject_map = partial "util/map_set" (dict "data" $subject_map "keys" (slice $version (anchorize $doc.Params.subjects)) "value" $doc) -}}
  {{- end -}}
{{- end -}}
{{- return $subject_map -}}